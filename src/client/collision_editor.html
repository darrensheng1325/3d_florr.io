<!DOCTYPE html>
<html>
<head>
    <title>Collision Plane Editor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code:wght@400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #2563eb;
            --secondary-color: #059669;
            --terrain-color: #d97706;
            --wall-color: #dc2626;
            --background: #f8fafc;
            --surface: #ffffff;
            --border: #e2e8f0;
            --text: #334155;
            --text-light: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text);
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            min-height: 100vh;
            gap: 0;
        }
        
        .sidebar {
            background: var(--surface);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .main-content {
            background: var(--background);
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.25rem;
        }
        
        .header p {
            color: var(--text-light);
            font-size: 0.875rem;
        }
        
        #canvas-container {
            flex: 1;
            position: relative;
            margin: 1rem;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }
        
        .tabs {
            display: flex;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
        }
        
        .tab {
            flex: 1;
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.2s;
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }
        
        .tab:hover:not(.active) {
            background: rgba(0, 0, 0, 0.05);
        }
        
        .tab-content {
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.75rem;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        input[type="number"], input[type="range"], select {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            background: var(--surface);
        }
        
        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .range-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        input[type="range"] {
            flex: 1;
            height: 0.375rem;
            border-radius: 0.25rem;
            background: var(--border);
            outline: none;
            padding: 0;
        }
        
        .range-value {
            min-width: 3rem;
            text-align: center;
            font-weight: 500;
            color: var(--text-light);
            font-size: 0.75rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }
        
        .btn-secondary {
            background: var(--border);
            color: var(--text);
        }
        
        .btn-secondary:hover {
            background: #cbd5e1;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .plane-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .plane-card:hover {
            box-shadow: var(--shadow);
            transform: translateY(-1px);
        }
        
        .plane-card.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .plane-card.terrain {
            border-left: 4px solid var(--terrain-color);
        }
        
        .plane-card.wall {
            border-left: 4px solid var(--wall-color);
        }
        
        .plane-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .plane-title {
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .plane-type-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .plane-type-badge.terrain {
            background: rgba(217, 119, 6, 0.1);
            color: var(--terrain-color);
        }
        
        .plane-type-badge.wall {
            background: rgba(220, 38, 38, 0.1);
            color: var(--wall-color);
        }
        
        .plane-body {
            padding: 1rem;
        }
        
        .plane-properties {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.75rem;
        }
        
        .property {
            color: var(--text-light);
        }
        
        .property strong {
            color: var(--text);
        }
        
        .view-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 0.75rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow);
            display: flex;
            gap: 0.5rem;
        }
        
        .view-controls .btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }
        
        .preset-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .export-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .export-section h4 {
            margin-bottom: 0.75rem;
            color: var(--text);
        }
        
        textarea {
            width: 100%;
            min-height: 8rem;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            font-family: 'Fira Code', monospace;
            font-size: 0.75rem;
            line-height: 1.5;
            resize: vertical;
        }
        
        .status-bar {
            background: var(--surface);
            border-top: 1px solid var(--border);
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: var(--text-light);
        }
        
        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .sidebar {
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="tabs">
                <button class="tab active" data-tab="properties">Properties</button>
                <button class="tab" data-tab="planes">Planes</button>
                <button class="tab" data-tab="export">Export</button>
            </div>
            
            <div class="tab-content" id="properties-tab">
                <div class="form-group">
                    <label>Plane Type</label>
                    <select id="plane-type">
                        <option value="wall">Wall</option>
                        <option value="terrain">Terrain</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Position</label>
                    <div class="form-row">
                        <div class="input-group">
                            <label>X</label>
                            <input type="number" id="x-pos" value="0" step="0.5">
                        </div>
                        <div class="input-group">
                            <label>Y</label>
                            <input type="number" id="y-pos" value="0" step="0.5">
                        </div>
                        <div class="input-group">
                            <label>Z</label>
                            <input type="number" id="z-pos" value="0" step="0.5">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Dimensions</label>
                    <div class="form-row">
                        <div class="input-group">
                            <label>Width</label>
                            <input type="number" id="width" value="5" step="0.5" min="0.1">
                        </div>
                        <div class="input-group">
                            <label>Height</label>
                            <input type="number" id="height" value="5" step="0.5" min="0.1">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Rotation X</label>
                    <div class="range-container">
                        <input type="range" id="rotation-x-range" min="-180" max="180" value="0" step="1">
                        <span class="range-value" id="rotation-x-value">0°</span>
                    </div>
                    <input type="number" id="rotation-x" value="0" step="1" min="-180" max="180" style="margin-top: 0.5rem;">
                </div>
                
                <div class="form-group">
                    <label>Rotation Y</label>
                    <div class="range-container">
                        <input type="range" id="rotation-y-range" min="-180" max="180" value="0" step="1">
                        <span class="range-value" id="rotation-y-value">0°</span>
                    </div>
                    <input type="number" id="rotation-y" value="0" step="1" min="-180" max="180" style="margin-top: 0.5rem;">
                </div>
                
                <div class="form-group">
                    <label>Rotation Z</label>
                    <div class="range-container">
                        <input type="range" id="rotation-z-range" min="-180" max="180" value="0" step="1">
                        <span class="range-value" id="rotation-z-value">0°</span>
                    </div>
                    <input type="number" id="rotation-z" value="0" step="1" min="-180" max="180" style="margin-top: 0.5rem;">
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" id="add-plane">➕ Add Plane</button>
                    <button class="btn btn-success" id="update-plane">💾 Update</button>
                    <button class="btn btn-danger" id="delete-plane">🗑️ Delete</button>
                </div>
                
                <div class="form-group">
                    <label>Terrain Presets</label>
                    <div class="preset-grid">
                        <button class="btn btn-warning" id="flat-terrain">🟩 Flat</button>
                        <button class="btn btn-warning" id="ramp-terrain">📐 Ramp 15°</button>
                        <button class="btn btn-warning" id="steep-ramp">⛰️ Steep 30°</button>
                        <button class="btn btn-warning" id="platform">🏗️ Platform</button>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="planes-tab" style="display: none;">
                <div id="planes-list"></div>
            </div>
            
            <div class="tab-content" id="export-tab" style="display: none;">
                <div class="export-section">
                    <h4>Export Configuration</h4>
                    <div class="btn-group" style="margin-bottom: 1rem;">
                        <button class="btn btn-primary" id="export-config">📋 Copy to Clipboard</button>
                        <button class="btn btn-secondary" id="download-config">💾 Download JSON</button>
                    </div>
                    <textarea id="config-output" placeholder="Configuration will appear here..." readonly></textarea>
                </div>
                
                <div class="export-section">
                    <h4>Import Configuration</h4>
                    <textarea id="config-input" placeholder="Paste JSON configuration here..."></textarea>
                    <div class="btn-group" style="margin-top: 1rem;">
                        <button class="btn btn-success" id="import-config">📥 Import</button>
                        <button class="btn btn-secondary" id="clear-all">🧹 Clear All</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1>Collision Plane Editor</h1>
                <p>Design and configure collision planes for your 3D environment</p>
            </div>
            
            <div id="canvas-container">
                <div class="view-controls">
                    <button class="btn btn-secondary" id="top-view">📐 Top</button>
                    <button class="btn btn-secondary" id="side-view">📏 Side</button>
                    <button class="btn btn-secondary" id="perspective-view">🎯 3D</button>
                </div>
            </div>
            
            <div class="status-bar">
                <span>Planes: <span id="plane-count">0</span></span>
                <span>Selected: <span id="selected-info">None</span></span>
                <span>Shortcuts: Ctrl+N (New) | Ctrl+D (Delete) | Ctrl+S (Export) | Del (Delete) | Arrow Keys (Move)</span>
            </div>
        </div>
    </div>

    <script>
        class CollisionPlaneEditor {
            constructor() {
                this.planes = [];
                this.selectedPlane = null;
                this.setupThreeJS();
                this.setupEventListeners();
                this.animate();
            }

            setupThreeJS() {
                // Create scene
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf0f0f0);

                // Create camera
                this.camera = new THREE.PerspectiveCamera(75, 800 / 600, 0.1, 1000);
                this.camera.position.set(20, 20, 20);
                this.camera.lookAt(0, 0, 0);

                // Create renderer
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(800, 600);
                document.getElementById('canvas-container').appendChild(this.renderer.domElement);

                // Add orbit controls
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;

                // Add lights
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 20, 10);
                this.scene.add(directionalLight);

                // Add grid helper
                const gridHelper = new THREE.GridHelper(40, 40, 0x000000, 0x000000);
                gridHelper.position.y = 0;
                this.scene.add(gridHelper);

                // Add axes helper
                const axesHelper = new THREE.AxesHelper(5);
                this.scene.add(axesHelper);
            }

            setupEventListeners() {
                // Tab switching
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
                });

                // Range slider synchronization
                this.setupRangeSliders();

                // Button event listeners
                document.getElementById('add-plane').addEventListener('click', () => this.addPlane());
                document.getElementById('update-plane').addEventListener('click', () => this.updateSelectedPlane());
                document.getElementById('delete-plane').addEventListener('click', () => this.deleteSelectedPlane());
                document.getElementById('export-config').addEventListener('click', () => this.exportConfig());
                document.getElementById('download-config').addEventListener('click', () => this.downloadConfig());
                document.getElementById('import-config').addEventListener('click', () => this.importConfig());
                document.getElementById('clear-all').addEventListener('click', () => this.clearAll());
                
                // Terrain preset buttons
                document.getElementById('flat-terrain').addEventListener('click', () => this.applyTerrainPreset('flat'));
                document.getElementById('ramp-terrain').addEventListener('click', () => this.applyTerrainPreset('ramp'));
                document.getElementById('steep-ramp').addEventListener('click', () => this.applyTerrainPreset('steepRamp'));
                document.getElementById('platform').addEventListener('click', () => this.applyTerrainPreset('platform'));
                
                // View controls
                document.getElementById('top-view').addEventListener('click', () => {
                    this.camera.position.set(0, 30, 0);
                    this.camera.lookAt(0, 0, 0);
                });
                
                document.getElementById('side-view').addEventListener('click', () => {
                    this.camera.position.set(30, 0, 0);
                    this.camera.lookAt(0, 0, 0);
                });
                
                document.getElementById('perspective-view').addEventListener('click', () => {
                    this.camera.position.set(20, 20, 20);
                    this.camera.lookAt(0, 0, 0);
                });

                // Raycaster for plane selection
                this.raycaster = new THREE.Raycaster();
                this.mouse = new THREE.Vector2();

                this.renderer.domElement.addEventListener('click', (event) => {
                    const rect = this.renderer.domElement.getBoundingClientRect();
                    this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                    this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
                    this.handleCanvasClick();
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (event) => {
                    if (event.ctrlKey) {
                        switch (event.key) {
                            case 'n':
                                event.preventDefault();
                                this.addPlane();
                                break;
                            case 'd':
                                event.preventDefault();
                                if (this.selectedPlane !== null) {
                                    this.deleteSelectedPlane();
                                }
                                break;
                            case 's':
                                event.preventDefault();
                                this.exportConfig();
                                break;
                        }
                    }
                    
                    // Delete key for deleting selected plane
                    if (event.key === 'Delete' && this.selectedPlane !== null) {
                        this.deleteSelectedPlane();
                    }

                    // Arrow keys for moving selected plane
                    if (this.selectedPlane !== null) {
                        const step = event.shiftKey ? 0.1 : 0.5;
                        const plane = this.planes[this.selectedPlane];
                        let updated = false;

                        switch (event.key) {
                            case 'ArrowLeft':
                                event.preventDefault();
                                plane.x -= step;
                                updated = true;
                                break;
                            case 'ArrowRight':
                                event.preventDefault();
                                plane.x += step;
                                updated = true;
                                break;
                            case 'ArrowUp':
                                event.preventDefault();
                                if (event.ctrlKey) {
                                    plane.y += step;
                                } else {
                                    plane.z -= step;
                                }
                                updated = true;
                                break;
                            case 'ArrowDown':
                                event.preventDefault();
                                if (event.ctrlKey) {
                                    plane.y -= step;
                                } else {
                                    plane.z += step;
                                }
                                updated = true;
                                break;
                        }

                        if (updated) {
                            this.updateSelectedPlane();
                            this.updateInputs();
                        }
                    }
                });

                // Real-time input updates
                ['x-pos', 'y-pos', 'z-pos', 'width', 'height'].forEach(id => {
                    document.getElementById(id).addEventListener('input', () => {
                        if (this.selectedPlane !== null) {
                            this.updateSelectedPlane();
                        }
                    });
                });

                document.getElementById('plane-type').addEventListener('change', () => {
                    if (this.selectedPlane !== null) {
                        this.updateSelectedPlane();
                    }
                });
            }

            applyTerrainPreset(preset) {
                document.getElementById('plane-type').value = 'terrain';
                
                switch (preset) {
                    case 'flat':
                        document.getElementById('rotation-x').value = 90;
                        document.getElementById('rotation-y').value = 0;
                        document.getElementById('rotation-z').value = 0;
                        document.getElementById('y-pos').value = 0;
                        break;
                    case 'ramp':
                        document.getElementById('rotation-x').value = 75; // 15° slope
                        document.getElementById('rotation-y').value = 0;
                        document.getElementById('rotation-z').value = 0;
                        document.getElementById('y-pos').value = 1;
                        break;
                    case 'steepRamp':
                        document.getElementById('rotation-x').value = 60; // 30° slope
                        document.getElementById('rotation-y').value = 0;
                        document.getElementById('rotation-z').value = 0;
                        document.getElementById('y-pos').value = 2;
                        break;
                    case 'platform':
                        document.getElementById('rotation-x').value = 90;
                        document.getElementById('rotation-y').value = 0;
                        document.getElementById('rotation-z').value = 0;
                        document.getElementById('y-pos').value = 3;
                        document.getElementById('width').value = 8;
                        document.getElementById('height').value = 8;
                        break;
                }
            }

            createPlaneMesh(plane) {
                const geometry = new THREE.PlaneGeometry(plane.width, plane.height);
                let material;
                
                if (plane.type === 'terrain') {
                    material = new THREE.MeshPhongMaterial({
                        color: 0x00ff00, // Green color to match ground plane
                        transparent: false,
                        opacity: 1.0,
                        side: THREE.DoubleSide,
                        shininess: 0  // Make it matte like the ground
                    });
                } else {
                    material = new THREE.MeshPhongMaterial({
                    color: 0x0000ff,
                    transparent: true,
                    opacity: 0.5,
                    side: THREE.DoubleSide
                });
                }
                
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(plane.x, plane.y, plane.z);
                
                // Apply rotations in order: X, Y, Z
                mesh.rotation.x = plane.rotationX * Math.PI / 180;
                mesh.rotation.y = plane.rotationY * Math.PI / 180;
                mesh.rotation.z = plane.rotationZ * Math.PI / 180;
                
                return mesh;
            }

            addPlane() {
                const plane = {
                    x: parseFloat(document.getElementById('x-pos').value),
                    y: parseFloat(document.getElementById('y-pos').value),
                    z: parseFloat(document.getElementById('z-pos').value),
                    width: parseFloat(document.getElementById('width').value),
                    height: parseFloat(document.getElementById('height').value),
                    rotationX: parseFloat(document.getElementById('rotation-x').value),
                    rotationY: parseFloat(document.getElementById('rotation-y').value),
                    rotationZ: parseFloat(document.getElementById('rotation-z').value),
                    type: document.getElementById('plane-type').value
                };
                
                const mesh = this.createPlaneMesh(plane);
                this.scene.add(mesh);
                
                this.planes.push({
                    ...plane,
                    mesh
                });
                
                this.updatePlanesList();
                this.updatePlaneColors();
            }

            updateSelectedPlane() {
                if (this.selectedPlane === null) return;
                
                const plane = this.planes[this.selectedPlane];
                plane.x = parseFloat(document.getElementById('x-pos').value);
                plane.y = parseFloat(document.getElementById('y-pos').value);
                plane.z = parseFloat(document.getElementById('z-pos').value);
                plane.width = parseFloat(document.getElementById('width').value);
                plane.height = parseFloat(document.getElementById('height').value);
                plane.rotationX = parseFloat(document.getElementById('rotation-x').value);
                plane.rotationY = parseFloat(document.getElementById('rotation-y').value);
                plane.rotationZ = parseFloat(document.getElementById('rotation-z').value);
                plane.type = document.getElementById('plane-type').value;
                
                // Update mesh
                this.scene.remove(plane.mesh);
                plane.mesh = this.createPlaneMesh(plane);
                this.scene.add(plane.mesh);
                
                this.updatePlanesList();
                this.updatePlaneColors();
            }

            deleteSelectedPlane() {
                if (this.selectedPlane === null) return;
                
                const plane = this.planes[this.selectedPlane];
                this.scene.remove(plane.mesh);
                this.planes.splice(this.selectedPlane, 1);
                this.selectedPlane = null;
                this.updatePlanesList();
                this.updatePlaneColors();
            }

            handleCanvasClick() {
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects(
                    this.planes.map(p => p.mesh)
                );

                if (intersects.length > 0) {
                    const clickedMesh = intersects[0].object;
                    this.selectedPlane = this.planes.findIndex(p => p.mesh === clickedMesh);
                    this.updatePlanesList();
                    this.updateInputs();
                    this.updatePlaneColors();
                }
            }

            updateInputs() {
                if (this.selectedPlane === null) return;
                const plane = this.planes[this.selectedPlane];
                document.getElementById('x-pos').value = plane.x;
                document.getElementById('y-pos').value = plane.y;
                document.getElementById('z-pos').value = plane.z;
                document.getElementById('width').value = plane.width;
                document.getElementById('height').value = plane.height;
                document.getElementById('rotation-x').value = plane.rotationX;
                document.getElementById('rotation-y').value = plane.rotationY;
                document.getElementById('rotation-z').value = plane.rotationZ;
                document.getElementById('plane-type').value = plane.type || 'wall';
                
                // Update range sliders
                document.getElementById('rotation-x-range').value = plane.rotationX;
                document.getElementById('rotation-y-range').value = plane.rotationY;
                document.getElementById('rotation-z-range').value = plane.rotationZ;
                document.getElementById('rotation-x-value').textContent = `${plane.rotationX}°`;
                document.getElementById('rotation-y-value').textContent = `${plane.rotationY}°`;
                document.getElementById('rotation-z-value').textContent = `${plane.rotationZ}°`;
            }

            updatePlaneColors() {
                this.planes.forEach((plane, index) => {
                    if (plane.type === 'terrain') {
                        plane.mesh.material.color.setHex(
                            index === this.selectedPlane ? 0x00CC00 : 0x00ff00  // Green shades for terrain
                        );
                    } else {
                    plane.mesh.material.color.setHex(
                        index === this.selectedPlane ? 0xff0000 : 0x0000ff
                    );
                    }
                });
            }

            switchTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.tab === tabName);
                });

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = content.id === `${tabName}-tab` ? 'block' : 'none';
                });
            }

            setupRangeSliders() {
                const sliders = [
                    { range: 'rotation-x-range', input: 'rotation-x', value: 'rotation-x-value' },
                    { range: 'rotation-y-range', input: 'rotation-y', value: 'rotation-y-value' },
                    { range: 'rotation-z-range', input: 'rotation-z', value: 'rotation-z-value' }
                ];

                sliders.forEach(({ range, input, value }) => {
                    const rangeElement = document.getElementById(range);
                    const inputElement = document.getElementById(input);
                    const valueElement = document.getElementById(value);

                    // Sync range to input
                    rangeElement.addEventListener('input', () => {
                        inputElement.value = rangeElement.value;
                        valueElement.textContent = `${rangeElement.value}°`;
                        if (this.selectedPlane !== null) {
                            this.updateSelectedPlane();
                        }
                    });

                    // Sync input to range
                    inputElement.addEventListener('input', () => {
                        rangeElement.value = inputElement.value;
                        valueElement.textContent = `${inputElement.value}°`;
                        if (this.selectedPlane !== null) {
                            this.updateSelectedPlane();
                        }
                    });
                });
            }

            downloadConfig() {
                const config = {
                    collisionPlanes: this.planes.map(({ mesh, ...plane }) => plane)
                };
                const json = JSON.stringify(config, null, 2);
                
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'collision-planes-config.json';
                a.click();
                URL.revokeObjectURL(url);
            }

            importConfig() {
                const input = document.getElementById('config-input').value.trim();
                if (!input) return;

                try {
                    const config = JSON.parse(input);
                    if (config.collisionPlanes && Array.isArray(config.collisionPlanes)) {
                        this.clearAll(false);
                        
                        config.collisionPlanes.forEach(plane => {
                            const mesh = this.createPlaneMesh(plane);
                            this.scene.add(mesh);
                            this.planes.push({ ...plane, mesh });
                        });
                        
                        this.updatePlanesList();
                        this.updateStatusBar();
                        document.getElementById('config-input').value = '';
                        alert('Configuration imported successfully!');
                    } else {
                        throw new Error('Invalid configuration format');
                    }
                } catch (error) {
                    alert('Error importing configuration: ' + error.message);
                }
            }

            clearAll(confirm = true) {
                if (confirm && !window.confirm('Are you sure you want to clear all planes?')) {
                    return;
                }

                this.planes.forEach(plane => {
                    this.scene.remove(plane.mesh);
                });
                this.planes = [];
                this.selectedPlane = null;
                this.updatePlanesList();
                this.updateStatusBar();
            }

            updatePlanesList() {
                const list = document.getElementById('planes-list');
                list.innerHTML = '';
                
                this.planes.forEach((plane, index) => {
                    const card = document.createElement('div');
                    card.className = `plane-card ${plane.type} ${index === this.selectedPlane ? 'selected' : ''}`;
                    
                    card.innerHTML = `
                        <div class="plane-header">
                            <div class="plane-title">
                                Plane ${index + 1}
                                <span class="plane-type-badge ${plane.type}">${plane.type}</span>
                            </div>
                        </div>
                        <div class="plane-body">
                            <div class="plane-properties">
                                <div class="property">Position: <strong>${plane.x}, ${plane.y}, ${plane.z}</strong></div>
                                <div class="property">Size: <strong>${plane.width} × ${plane.height}</strong></div>
                                <div class="property">Rotation X: <strong>${plane.rotationX}°</strong></div>
                                <div class="property">Rotation Y: <strong>${plane.rotationY}°</strong></div>
                                <div class="property">Rotation Z: <strong>${plane.rotationZ}°</strong></div>
                                <div class="property">Type: <strong>${plane.type}</strong></div>
                            </div>
                        </div>
                    `;
                    
                    card.addEventListener('click', () => {
                        this.selectedPlane = index;
                        this.updatePlanesList();
                        this.updateInputs();
                        this.updatePlaneColors();
                        this.updateStatusBar();
                    });
                    
                    list.appendChild(card);
                });
                
                this.updateStatusBar();
            }

            updateStatusBar() {
                document.getElementById('plane-count').textContent = this.planes.length;
                const selectedInfo = this.selectedPlane !== null 
                    ? `Plane ${this.selectedPlane + 1} (${this.planes[this.selectedPlane].type})`
                    : 'None';
                document.getElementById('selected-info').textContent = selectedInfo;
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }

            exportConfig() {
                const config = {
                    collisionPlanes: this.planes.map(({ mesh, ...plane }) => plane)
                };
                const json = JSON.stringify(config, null, 2);
                
                // Update the export textarea
                document.getElementById('config-output').value = json;
                
                // Copy to clipboard
                navigator.clipboard.writeText(json).then(() => {
                    alert('Configuration copied to clipboard!');
                }).catch(() => {
                    // Fallback for older browsers
                    const textarea = document.createElement('textarea');
                    textarea.value = json;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    alert('Configuration copied to clipboard!');
                });
                
                // Switch to export tab
                this.switchTab('export');
            }
        }

        // Initialize the editor when the page loads
        window.addEventListener('load', () => {
            new CollisionPlaneEditor();
        });
    </script>
</body>
</html> 